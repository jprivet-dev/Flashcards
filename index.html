<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flashcards</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container-lg pt-4">
    <header class="d-flex align-items-center pb-3 mb-4 border-bottom">
        <h1 id="h1-main-title" class="fs-4 m-0 p-0">Flashcards</h1>
    </header>
</div>

<section id="data-loading-section">
    <div class="container-lg">

        <div class="d-flex flex-column flex-sm-row justify-content-sm-between align-items-sm-center mb-4 g-2">
            <h2 class="mb-2">1. Charger vos données</h2>
            <button data-action="showDataDisplaySection" class="btn btn-primary rounded-pill mb-2 d-none" title="Revenir aux données">
                Données
                <ion-icon name="arrow-forward-outline"></ion-icon>
            </button>
        </div>

        <div class="tabs-container mb-4">
            <nav class="nav nav-tabs" id="dataTabs" role="tablist">
                <button class="nav-link active" id="text-tab" data-bs-toggle="tab" data-bs-target="#text-pane" type="button" role="tab" aria-controls="text-pane" aria-selected="false">Coller un texte</button>
                <button class="nav-link" id="sheet-tab" data-bs-toggle="tab" data-bs-target="#sheet-pane" type="button" role="tab" aria-controls="sheet-pane" aria-selected="true">Google Sheets</button>
            </nav>
            <div class="tab-content" id="dataTabContent">
                <div class="tab-pane active" id="text-pane" role="tabpanel" aria-labelledby="text-tab">
                    <div class="my-4">
                        <label for="title-text-input" class="form-label">Renseigner un titre <span class="text-secondary">(optionnel)</span> :</label>
                        <input type="text" id="title-text-input" class="form-control"></input>
                    </div>
                    <div class="my-4">
                        <label for="text-input" class="form-label">Coller votre texte ici :</label>
                        <div class="input-group">
                            <textarea id="text-input" class="form-control" rows="5" placeholder="Recto 1, Verso 1, Notes 1&#10;Recto 2, Verso 2, Notes 1"></textarea>
                            <button data-action="clearTextLocalStorageConfirm" class="btn btn-outline-secondary" type="button" title="Effacer">
                                <ion-icon name="close-circle-outline"></ion-icon>
                            </button>
                        </div>
                        <div class="text-body-secondary mt-2">
                            <ul>
                                <li><small>Donnez des valeurs séparées par des virgules, des points-virgules ou des tabulations.</small></li>
                                <li><small>Les colonnes Recto et Verso sont obligatoires. La colonne Notes est optionnelle.</small></li>
                                <li><small>Ne mettez pas d'en-têtes aux colonnes Recto, Verso et Notes.</small></li>
                                <li><small>Votre navigateur garde dans sa mémoire locale le texte collé : vous pouvez rafraîchir la page et retrouver vos données actuelles.</small></li>
                            </ul>
                        </div>
                    </div>
                    <div class="mb-4">
                        <select class="form-select" id="example-select">
                            <option value="">-- Ou utiliser un exemple de cette liste --</option>
                            <option value="example">Exemple très simple</option>
                            <option value="multiplication">Tables de multiplication</option>
                            <option value="verbs">Verbes irréguliers (3ème)</option>
                            <option value="periodic">Symboles des éléments chimiques</option>
                        </select>
                        <div class="text-body-secondary mt-2">
                            <ul>
                                <li><small>L'exemple que vous choisirez sera chargé automatiquement dans l'espace "Coller votre texte ici"</small></li>
                                <li><small>Le titre sera renseigné automatiquement.</small></li>
                            </ul>
                        </div>
                    </div>
                    <div class="input-group mb-4">
                        <label for="separator-select" class="input-group-text" id="basic-addon1">Séparateur :</label>
                        <select id="separator-select" class="form-select">
                            <option value=",">Virgule (,)</option>
                            <option value=";">Point-virgule (;)</option>
                            <option value="	">Tabulation</option>
                        </select>
                    </div>
                </div>
                <div class="tab-pane" id="sheet-pane" role="tabpanel" aria-labelledby="sheet-tab">
                    <div class="my-4">
                        <label for="title-url-input" class="form-label">Renseigner un titre <span class="text-secondary">(obligatoire)</span> :</label>
                        <input type="text" id="title-url-input" class="form-control"></input>
                    </div>
                    <div class="my-4">
                        <label for="url-input" class="form-label">Renseigner le lien vers votre fichier CSV Google Sheets public <span class="text-secondary">(obligatoire)</span> :</label>
                        <div class="input-group">
                            <input type="url" id="url-input" class="form-control">
                            <button data-action="clearUrlLocalStorageConfirm" class="btn btn-outline-secondary" type="button" title="Effacer">
                                <ion-icon name="close-circle-outline"></ion-icon>
                            </button>
                        </div>
                        <div class="text-body-secondary mt-2">
                            <ul>
                                <li><small>Chargez des données uniquement à partir de sources Google Sheets fiables !</small></li>
                                <li><small>Donnez un fichier CSV (valeurs séparées par des virgules).</small></li>
                                <li><small>Les colonnes Recto et Verso sont obligatoires. La colonne Notes est optionnelle.</small></li>
                                <li><small>Ne mettez pas d'en-têtes aux colonnes Recto, Verso et Notes.</small></li>
                                <li><small><a href="https://support.google.com/docs/answer/183965" target="_blank">Comment rendre votre fichier Google Sheets public ?</a> (lien externe)</small></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="d-grid gap-2 col-lg-6 mx-auto my-5">
                <button data-action="handleDataLoad" id="load-data-btn" class="btn btn-primary btn-lg rounded-pill">
                    <ion-icon name="cloud-upload-outline"></ion-icon>
                    Charger les données
                </button>
            </div>
        </div>
    </div>
</section>

<section id="data-display-section" class="mb-4 d-none">
    <div class="container-lg">
        <div class="d-flex justify-content-between mb-4">
            <button data-action="showDataLoadingSection" class="btn btn-primary rounded-pill mb-md-0" id="back-to-load-data-btn" title="Charger vos données">
                <ion-icon name="arrow-back-outline"></ion-icon>
                Charger
            </button>
            <div class="d-flex align-items-end gap-2">
                <button data-action="startSession" data-param="sequential" class="btn btn-success rounded-pill" title="Commencer la révision dans l'ordre">
                    <ion-icon class="ion-icon-me-0" name="play-forward-outline"></ion-icon>
                </button>
                <button data-action="startSession" data-param="random" class="btn btn-warning rounded-pill" title="Commencer la révision aléatoire">
                    <ion-icon class="ion-icon-me-0" name="shuffle-outline"></ion-icon>
                </button>
                <button data-action="showQuiz" class="btn btn-primary rounded-pill" title="C'est parti pour le quiz !">
                    <ion-icon class="ion-icon-me-0" name="rocket-outline"></ion-icon>
                </button>
            </div>
        </div>

        <h2 class="m-0 pb-4">2. Aperçu des données <span id="from-google-sheet">(Google Sheets)</span></h2>

        <div id="shareable-csv-link-input-wrapper" class="mb-4 d-none">
            <label for="shareable-csv-link-input" class="form-label">Partager le lien :</label>
            <div class="input-group">
                <input type="text" class="form-control" id="shareable-csv-link-input" readonly>
                <button data-action="copyShareableUrl" class="btn btn-outline-secondary" type="button" id="copy-url-btn" title="Copier le lien">
                    <ion-icon name="copy-outline"></ion-icon>
                </button>
            </div>
            <div class="text-body-secondary">
                <ul>
                    <li><small>Le lien à partager contiendra en paramètres le titre de cette page et le lien vers le fichier CSV (Google Sheets) à charger.</small></li>
                    <li><small>Au tout premier chargement du lien copié, les données du fichier CSV (Google Sheets) seront téléchargées et gardées 24 heures en mémoire dans le navigateur (Chrome, Firefox, Edge, ...).</small></li>
                    <li><small>Au-delà des 24 heures, les données du fichier CSV (Google Sheets) seront à nouveau téléchargées et mises à jour dans le navigateur.</small></li>
                </ul>
            </div>
        </div>

        <div class="border rounded p-4 mb-4">
            <div class="row">
                <div class="col-auto">
                    <button data-action="toggleContentSwap" class="btn btn-primary mb-4">
                        <ion-icon name="swap-horizontal-outline"></ion-icon>
                        Inverser les données Recto et Verso
                    </button>
                </div>
                <div class="col-auto">
                    <div class="input-group mb-4">
                        <label class="input-group-text" for="font-select">Choix de la police :</label>
                        <select class="form-select" id="font-select">
                            <option value="default">Par défaut</option>
                            <option value="lexend">Lexend</option>
                            <option value="open-dyslexic">OpenDyslexic</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="row g-2 mb-4 align-items-center">
                <div class="col-sm-auto">
                    <label for="start-row-select" class="form-label mb-0">De la ligne</label>
                </div>
                <div class="col-sm-2 col-lg-2">
                    <select id="start-row-select" class="form-select"></select>
                </div>
                <div class="col-sm-auto">
                    <label for="end-row-select" class="form-label mb-0">à la ligne</label>
                </div>
                <div class="col-sm-2 col-lg-2">
                    <select id="end-row-select" class="form-select"></select>
                </div>
                <div class="col-sm-auto">
                    <button data-action="selectRowsByRange" class="btn btn-primary w-100">Sélectionner</button>
                </div>
                <div class="col-sm-auto">
                    <button data-action="toggleAllCheckboxes" data-param="false" class="btn btn-secondary w-100">Désélectionner tout</button>
                </div>
            </div>
            <div>
                <div class="input-group">
                    <input type="text" id="filter-input" class="form-control" placeholder="Filtrer les colonnes Recto, Verso et Notes...">
                    <button data-action="resetFilter" class="btn btn-outline-secondary" type="button" title="Réinitialiser le filtre">
                        <ion-icon name="close-circle-outline"></ion-icon>
                    </button>
                </div>
                <div class="form-text text-end" id="basic-addon4">
                    <span id="visible-rows-count">0</span> carte(s) affichée(s) sur <span id="total-rows-count">0</span>.
                </div>
            </div>
        </div>

        <div class="table-responsive">
            <table id="flashcard-table" class="table">
                <thead>
                <tr>
                    <th><input type="checkbox" checked id="select-all-checkbox"></th>
                    <th data-sort-index="1" class="text-center sortable">
                        #
                        <span class="sort-icon-container">
                            <ion-icon name="caret-up-outline" class="sort-icon asc-icon"></ion-icon>
                            <ion-icon name="caret-down-outline" class="sort-icon desc-icon"></ion-icon>
                        </span>
                    </th>
                    <th data-sort-index="2" class="sortable">
                        Recto
                        <span class="sort-icon-container">
                            <ion-icon name="caret-up-outline" class="sort-icon asc-icon"></ion-icon>
                            <ion-icon name="caret-down-outline" class="sort-icon desc-icon"></ion-icon>
                        </span>
                    </th>
                    <th data-sort-index="3" class="sortable">
                        Verso
                        <span class="sort-icon-container">
                            <ion-icon name="caret-up-outline" class="sort-icon asc-icon"></ion-icon>
                            <ion-icon name="caret-down-outline" class="sort-icon desc-icon"></ion-icon>
                        </span>
                    </th>
                    <th data-sort-index="4" class="sortable">
                        Notes
                        <span class="sort-icon-container">
                            <ion-icon name="caret-up-outline" class="sort-icon asc-icon"></ion-icon>
                            <ion-icon name="caret-down-outline" class="sort-icon desc-icon"></ion-icon>
                        </span>
                    </th>
                </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>

        <div class="d-grid gap-2 col-lg-6 mx-auto my-5">
            <button data-action="startSession" data-param="sequential" class="btn btn-success btn-lg rounded-pill">
                <ion-icon name="play-forward-outline"></ion-icon>
                Commencer la révision dans l'ordre
            </button>
            <button data-action="startSession" data-param="random" class="btn btn-warning btn-lg rounded-pill">
                <ion-icon name="shuffle-outline"></ion-icon>
                Commencer la révision aléatoire
            </button>
            <button data-action="showQuiz" class="btn btn-primary btn-lg rounded-pill">
                <ion-icon name="rocket-outline"></ion-icon>
                C'est parti pour le quiz !
            </button>
        </div>
    </div>
</section>

<section id="flashcards-section" class="d-none mt-4">
    <div class="container-lg">
        <div class="d-flex flex-column flex-md-row justify-content-md-between align-items-md-center mb-4">
            <button data-action="showDataDisplaySection" class="btn btn-primary rounded-pill mb-2 mb-md-0" title="Revenir aux données">
                <ion-icon name="arrow-back-outline"></ion-icon>
                Données
            </button>
            <div class="d-flex flex-column flex-md-row gap-2">
                <div class="btn-group" role="group">
                    <button data-action="filterCards" data-param="unflipped" class="btn btn-outline-primary rounded-start-pill" title="Réviser avec les cartes non retournées">
                        <ion-icon name="sync-outline"></ion-icon>
                        Réviser <span class="unflipped-count badge rounded-pill text-bg-primary">0</span>
                    </button>
                    <button data-action="filterCards" data-param="all" class="btn btn-outline-primary rounded-end-pill" id="show-all-btn" title="Afficher toutes les cartes">
                        <ion-icon name="grid-outline"></ion-icon>
                        Toutes <span id="all-count" class="badge rounded-pill text-bg-primary">0</span>
                    </button>
                </div>
                <div class="btn-group" role="group">
                    <button data-action="flipAllFlashcardsTo" data-param="recto" class="btn btn-outline-primary rounded-start-pill" id="flip-all-recto-btn" title="Toutes les cartes au recto">
                        <ion-icon name="arrow-undo-outline"></ion-icon>
                        Recto
                    </button>
                    <button data-action="flipAllFlashcardsTo" data-param="verso" class="btn btn-outline-primary rounded-end-pill" id="flip-all-verso-btn" title="Toutes les cartes au verso">
                        <ion-icon name="arrow-redo-outline"></ion-icon>
                        Verso
                    </button>
                </div>
                <button data-action="switchCardsSize" class="switch-cards-size-btn btn btn-outline-primary rounded-pill" title="Changer la taille des cartes">
                    <span class="expand">
                        <ion-icon name="expand-outline"></ion-icon>
                    </span>
                    <span class="contract">
                        <ion-icon name="contract-outline"></ion-icon>
                    </span>
                </button>
                <button data-action="toggleHintMode" class="btn btn-outline-primary rounded-pill" title="Mode indice (révèle progressivement le verso)">
                    <ion-icon name="eye-outline"></ion-icon>
                    <span></span>
                </button>
            </div>
        </div>
    </div>
    <div class="container-xxl g-0">
        <div id="flashcard-grid-container">
        </div>
        <div class="text-center my-5 py-5">
            <button data-action="filterCards" class="btn btn-outline-primary rounded-pill mb-4 d-block mx-auto">
                <ion-icon name="sync-outline"></ion-icon>
                Réviser avec les cartes non retournées <span class="unflipped-count badge rounded-pill text-bg-primary">0</span>
            </button>
            <button data-action="showQuiz" class="btn btn-outline-primary rounded-pill d-block mx-auto">
                <ion-icon name="rocket-outline"></ion-icon>
                C'est parti pour le quiz !
            </button>
        </div>
    </div>
</section>

<section id="quiz-section" class="d-none">
    <div class="container-lg">
        <div class="d-flex flex-column flex-md-row justify-content-md-between align-items-md-center mb-4">
            <button data-action="showDataDisplaySection" class="btn btn-primary rounded-pill mb-3 mb-md-0" title="Revenir aux données">
                <ion-icon name="arrow-back-outline"></ion-icon>
                Données
            </button>
            <div class="d-flex flex-column flex-md-row gap-2">
                <!--            <button data-action="launchConfetti" id="confetti-btn" class="btn btn-primary rounded-pill mb-2 mb-md-0" title="Revenir aux données">-->
                <!--                Confettis-->
                <!--            </button>-->
                <button data-action="checkAnswers" class="check-answers-btn btn btn-outline-primary rounded-pill mb-2 mb-md-0">
                    <ion-icon name="checkmark-circle-outline"></ion-icon>
                    Vérifier
                </button>
                <button data-action="switchCardsSize" class="switch-cards-size-btn btn btn-outline-primary rounded-pill" title="Changer la taille des cartes">
                    <span class="expand">
                        <ion-icon name="expand-outline"></ion-icon>
                    </span>
                    <span class="contract">
                        <ion-icon name="contract-outline"></ion-icon>
                    </span>
                </button>
            </div>
        </div>
        <div id="quiz-scores" class="card mb-5 text-center border-0 bg-transparent d-none">
            <h3 class="card-title mb-4">Résultats du quiz</h3>
            <div class="row g-4 justify-content-center">
                <div class="col-sm-4">
                    <div class="p-3 bg-info-subtle rounded-3 shadow-sm">
                        <h2 class="fs-1 mb-1 text-info">
                            <ion-icon name="analytics-outline"></ion-icon>
                            <span id="percentage-score">0</span>%
                        </h2>
                        <small class="text-info">Taux de réussite</small>
                    </div>
                </div>
                <div class="col-sm-4">
                    <div class="p-3 bg-success-subtle rounded-3 shadow-sm">
                        <h2 class="fs-1 mb-1 text-success">
                            <ion-icon name="checkmark-circle-outline"></ion-icon>
                            <span id="correct-count">0</span>
                        </h2>
                        <small class="text-success">Bonnes réponses</small>
                    </div>
                </div>
                <div class="col-sm-4">
                    <div class="p-3 bg-danger-subtle rounded-3 shadow-sm">
                        <h2 class="fs-1 mb-1 text-danger">
                            <ion-icon name="close-circle-outline"></ion-icon>
                            <span id="incorrect-count">0</span>
                        </h2>
                        <small class="text-danger">Mauvaises réponses</small>
                    </div>
                </div>
            </div>
        </div>
        <div id="quiz-cards-container" class="g-4 mb-4">
        </div>
        <button data-action="checkAnswers" class="check-answers-btn btn btn-outline-primary rounded-pill d-block mx-auto my-5 btn-lg">
            <ion-icon name="checkmark-circle-outline"></ion-icon>
            Vérifier les réponses
        </button>
    </div>
</section>

<div id="progress-indicator" class="d-none">
    <div class="progress rounded-0" role="progressbar" aria-label="Progression de la révision" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
        <div class="progress-bar bg-warning" id="progress-bar" style="width: 0"></div>
    </div>
</div>

<div id="notes-footer" class="shadow-lg">
    <div class="container-notes container-lg">
        <div class="d-flex justify-content-start m-0 py-3">
            <ion-icon name="information-circle" class="text-primary"></ion-icon>
            <p id="notes-content" class="m-0 p-0"></p>
        </div>
    </div>
    <button data-action="scrollToTop" id="scrollToTopBtn" class="btn btn-primary text-center" title="Aller en haut de la page">
        <ion-icon name="arrow-up-outline"></ion-icon>
    </button>
</div>

<div class="modal fade" id="choiceModal" tabindex="-1" aria-labelledby="choiceModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="choiceModalLabel">Conflit de données</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Les deux champs (texte et Google Sheets) contiennent des données. Veuillez choisir la source que vous souhaitez utiliser :</p>
            </div>
            <div class="modal-footer">
                <button data-action="loadFromSource" data-param="text" type="button" class="btn btn-secondary" data-bs-dismiss="modal">Utiliser le texte copié</button>
                <button data-action="loadFromSource" data-param="url" type="button" class="btn btn-primary" data-bs-dismiss="modal">Utiliser Google Sheets</button>
            </div>
        </div>
    </div>
</div>

<div class="container-lg">
    <footer class="py-5 border-top">
        <p class="text-body-secondary m-0">
            Code <strong>Open Source</strong> disponible sur <a href="https://github.com/jprivet-dev/Flashcards" target="_blank">GitHub</a>.
        </p>
    </footer>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
<script type="module" src="script.js"></script>
</body>
</html>
